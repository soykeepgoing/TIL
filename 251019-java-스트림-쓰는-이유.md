# 배경

for문 보다 깔끔해보인다는 장점 때문에 stream 사용을 해왔는데 막상 생각해보면 명확한 강점이 뭔지 잘 모르는 것 같아 찾아보고 정리해본다. 

# 분석

**무엇을 하는가?** 

데이터의 흐름을 다루기 위한 api로 list, map 등의 컬렉션 요소를 반복하지 않고 함수형 스타일로 처리할 수 있도록 도화준다. 

for문 없이 컬렉션의 요소를 순회하며 데이터를 필터링하고 집계하는 과정이다. 

**특징** 

1. 컬렉션의 데이터 요소가 변경되지 않고 (immutable), 새로운 결과를 생성한다.  
2. 스트림은 한 번 쓰면 끝이다. 재사용 불가 
3. 중간 연산 (가공)과 터미널 연산 (반환)로 이루어 진다.
    1. 중간 연산: filter, map, sorted
    2. 터미널 연산: collect, forEach, count 

**왜 쓰는가?** 

1. 코드의 간결성 
    1. 코드의 복잡도가 낮아진다. 
2. 선언적 프로그래밍 사용 
    1. lambda를 통해 사용되기 때문에 어떤 기능을 수행할지 직관적으로 파악할 수 있다. 
3. 병렬 처리 
    1. cpu 멀티코어를 통해 손쉽게 병렬처리가 가능하다. 

**성능 효율** 

| 방식 | 시간 복잡도  | 효율 |
| --- | --- | --- |
| for문 | O(n) | 단일 스레드, 명령형 처리 |
| stream | O(n) | 단일 스레드, 함수형 처리  |
| parallelStream | O(n/p) | 다중 스레드, 함수형 처리  |

성능의 측면에서 스트림이 일반 for문에 비해 빠른 것은 아니다. 

오히려 데이터의 양이 작을 수록 for문의 성능이 stream보다 크다고 볼 수 있다. (왜? 함수 호출등을 해야하니까)

그럼에도 가독성 향상, 함수형 코드, 병렬처리 유리라는 점에서 stream 사용이 권장된다.

# 결과

1. 스트림은 자바 코드 가독성 향상에 큰 도움을 준다. 
2. 선언적 프로그래밍으로 코드 기능에 대한 파악이 확실하며 데이터 불변성 덕분에 안전하게 데이터를 다룰 수 있다. 
3. 시간의 측면에서도 효율성이 높을 줄 알았는데, 내부 동작으로는 마찬가지로 순회하는 작업을 거치나보다. 
    
    ```java
    // jdk/src/java.base/share/classes/java/util/stream/StreamSpliterators.java tryadvance()
    while (sliceOrigin > index) {
    	s.tryAdvance(emptyConsumer());
    	index++;
    }
    ```
    
    실제 내부 구현 코드를 봐도 이런 방식으로 while 반복문을 사용해서 순회하는 것을 알 수 있다.